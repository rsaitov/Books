# Стив Макконнелл - Совершенный код
<p align="center">
  <img width="300" src="https://github.com/rsaitov/Books/blob/master/%D0%A1%D1%82%D0%B8%D0%B2%20%D0%9C%D0%B0%D0%BA%D0%BA%D0%BE%D0%BD%D0%BD%D0%B5%D0%BB%D0%BB%20-%20%D0%A1%D0%BE%D0%B2%D0%B5%D1%80%D1%88%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9%20%D0%BA%D0%BE%D0%B4/title.png" />
</p>

Главный технический императив конструирования ПО - борьба со сложностью!
Программируем *с использованием* языка, а не *на* языке.

# Часть II - Высококачественный код
## Глава 8 - Защитное программирование
Как защититься от беспощадного мира неверных данных, событий, которые "никогда" не могут случиться, и других программистских ошибок.
Выражение "Garbage in, garbage out" - признак небрежного, небезопасного кода.

Три основных способа обработки входных мусорных данных:
- проверяйте все данные из внешних источников;
- проверяйте значения всех входных параметров метода;
- решите как обрабатывать неправильные входные данные.
Обеспечение защиты от мелочей может значить больше, чем кажется
### Утверждения (assertions)
Утверждение - это код (обычно метод или макрос), используемый во время разработки, с помощью которого программа проверяет правильность своего выполнения.

__Пример утверждения(Java):__
```Java
assert denominator != 0 : "denominator is unexpectedly equal to 0.";
```

Общие положения по применению утверждений:
- используйте процедуры обработки ошибок для ожидаемых событий и утверждения для событий, которые происходить не должны;
- старайтесь не помещать выполняемый код в утверждения;
- используйте утверждения для документирования и проверки предусловий (обязательства клиентского кода перед вызываемым кодом) и постусловий (обязательства метода или класса перед кодом, который их использует);
- для большей устойчивости кода проверяйте утверждения, а затем все равно обработайте возможные ошибки.
### Способы обработки ошибок
- вернуть нейтральное значение;
- заменить следующим корректным блоком данных;
- вернуть тот же результат, что и в прошлый раз;
- подставить ближайшее допустимое значение;
- записать предупреждающее сообщение в файл. Можно сочетать с другими подходами.
- вернуть код ошибки, сгенерировать исключение;
- вызвать процедуру или объект - обработчик ошибок;
- показать сообщение об ошибке, где бы они ни случилась;
- обработать ошибку в месте возникновения наиболее подходящим способом;
- прекратить выполнение.

Устойчивость vs Корректность

Корректность - нельзя возвращать неточный результат; лучше не вернуть ничего, чем неточное значение. Хороший пример - радиационная машина.
Устойчивость - всегда пытаться сделать что-то, что позволит программе продолжить работу, даже если это приведёт к частично неверным результатам. Хороший пример - потребительские приложения.
### Исключения
- используйте исключения для оповещения других частей программы об ошибках, которые нельзя игнорировать;
- генерируйте исключения только для действительно исключительных ситуаций;
- не используйте исключения по мелочам;
- избегайте генерировать исключения в конструкторах и деструкторах, если только вы не перехватываете их позднее;
- генерируйте исключения на правильно уровне абстракции;
- вносите в описание исключения всю информация о его причинах;
- избегайте пустых блоков catch();
- выясните какие исключения генерирует используемая библиотека; создайте код-прототип и протестируйте библиотеки, что выявить исключения;
- рассмотрите вопрос о централизованном выводе информации об исключениях;
- стандартизуйте использование исключений в вашем проекте;
- рассмотрите альтернативы исключениям.

Иногда лучшей реакцией на серьезную ошибку периода выполнения будет освобождение всех ресурсов и прекращение работы.
### Изоляция повреждений, вызванных ошибками
Разработка набора интерфейсов в качестве оболочки для "безопасных" частей кода. Проверяйте корректность данных, пересекающих границу безопасной области, и реагируйте соответственно, если данные неправильные.

Преобразовывайте входные данные к нужному типу в момент ввода. Преобразуйте данные к надлежащему виду как можно раньше.
### Отладочные средства
Будьте готовы поступить скоростью и ресурсоёмкостью во время разработки в обмен на встроенные средства, позволяющие процессу разработки двигаться более гладко.

"Неработающая программа обычно приносит меньше вреда, чем работающая плохо." (Энди Хант и Дэйв Томас)

Наступательное программирование - исключительные случаи должны обрабатываться так, чтобы во время разработки они были очевидны, а в промышленном коде - позволяли продолжить работу.

Как избежать постоянного перетаскивания отладочного кода в программу и из неё:
- для контроля версий и сборки программы используйте инструменты ant и make. Можно регулировать включение отладочного кода или нет.
- используйте встроенный препроцессор (#define DEBUG);
- напишите собственный препроцессор, если язык его не содержит;
- используйте отладочные заглушки;
### Доля защитного программирования в промышленной версии
Основные принципы для определения, какие инструменты защитного программирования следует оставить в промышленной версии, а какие - убрать:
- оставьте код, который проверяет существенные ошибки;
- удалите код, проверяющий незначительные ошибки;
- удалите код, приводящий к прекращению работы программы. Если программа содержит отладочный код, способный привести к потере данных, уберите его из промышленной версии.
- оставьте код, который позволяет аккуратно завершить работу программы;
- регистрируйте ошибки для отдела технической поддержки;
- убедитесь, что оставленные сообщения об ошибках дружелюбны
### Ключевые моменты
- промышленный код должен обрабатывать ошибки более изощренно, чем по принципу "мусор на входе - мусор на выходе";
- с помощью технологии защитного программирования ошибки легче находить, легче исправлять, и они наносят меньше вреда промышленному коду;
- утверждения позволяют обнаружить ошибки на ранней стадии, особенно в больших системах, системах повышенной надежности и в системах с часто изменяемым кодом;
- выбор способа обработки некорректных выходных данных - ключевое решение обработки ошибок, принимаемое на этапе высокоуровневого проектирования;
- исключения предоставляют возможность обработки ошибок в измерении, отличном от нормального хода алгоритма;
- ограничения, применяемые к промышленной версии системы, не обязательно должны относиться и ко времени разработки. Пользуясь этим преимуществом, вы можете добавлять в отладочную версию любой код, помогающий быстро выявлять ошибки.
