## Глава 26 - Методики оптимизации кода

Рефакторинг направлен на улучшение внутренней структуры программы. Оптимизация ухудшает внутреннюю структуру программы ради повышения ее производительности.

Никакой из видов оптимизации не следует применять слепо: результаты будут во многом зависеть от реализации конкретных компиляторов.
### Логика
- прекращение проверки сразу же после получения ответа;
- упорядочивание тестов по частоте;
- сравнение быстродействия похожих структур логики;
- замена сложных выражений на обращение к таблице;
- отложенные вычисления. Производить вычисление только по мере необходимости. После вычисления - сохранить данные (кеширование).
### Циклы
- размыкание цикла. Замыканием называется принятие решения внутри цикла при каждой его итерации. Если во время выполнения цикла решение не изменяется, вы можете разомкнуть (unswitch) цикл, приняв решение вне цикла;
- объединение циклов. Прежде чем объединять циклы, убедитесь, что это не нарушит работу остальных частей кода;
- развертывание циклов (unrolling);
- минимизация объема работы, выполняемой внутри циклов;
- сигнальные значения - значения, которые располагаются сразу после окончания диапазона поиска и непременно завершает поиск.
- вложение более ресурсоемкого цикла в менее ресурсоемкий;
- снижение стоимости операций - замена дорогой операции на более дешевую (например умножения на сложение)
### Изменения типов данных
- использование целых чисел вместо чисел с плавающей запятой;
- использование массивов с минимальным числом измерений;
- минимизация числа обращений к массивам;
- использование дополнительных индексов (например, индекс длины строки: слежение за длиной структуры часто - более эффективный подход, чем вычисление длины каждый раз, когда она требуется);
- кэширование - способ хранения нескольких значений, при котором значения, используемые чаще всего, получить легче, чем значения, используемые реже.
### Выражения
Многие задачи программирования требуют применени математических и логических выражений. Сложные выражения обычно дороги и далее рассмотрены способы их удешевления.
- алгебраические тождества. 
```
not a and not b
not (a or b) // выбрав этот вариант, вы сэкономите одну операцию __not__
```
- снижение стоимости операций (замена умножения сложением, замена возведения в степень умножением, замена тригонометрических функций их эквивалентами итп);
- инициализация во время компиляции;
- недостатки системных методов;
- использование констант корректного типа;
- предварительное вычисление результатов. При низкоуровневом проектировании часто приходится решать, вычислять ли результаты по ходу дела или лучше вычислить их один раз, сохранить и извлекать по мере надобности. Если результаты используются много раз, второй вариант часто предпочтительнее;
- устранение часто используемых подвыражений.
### Методы
Одним из самых эффективных способов оптимизации кода является грамотная декомпозиция программы на методы. Небольшие, хорошо определенные методы делают программу компактнее, устраняя повторяющиеся фрагменты кода.
### Переписывание кода на низкоуровневом языке
Переписывание кода на низкоуровневом языке обычно положительно влияет и на быстродействие кода, и на его объем.
### Если что-то одно изменяется, что-то другое всегда остаётся постоянным
Оптимизация кода неизбежно подразумевает нахождение компромисса между сложностью, удобочитаемостью, простотой и удобством сопровождения программы, с одной стороны, и желанием повысить производительность - с другой. Требуйте, чтобы оптимизация приводила к _измеримому улучшению_. Если оптимизация оправдывает профилирование кода и оценку результатов, наверное, ее следует выполниьт, если будет показано как она работает. Но если оптимизация не оправдывает проведения профилирования, она не может оправдать ухудшения удобочитаемости, удобства сопровождения и других характеристик кода.
### Ключевые моменты
- результаты конкретных видов оптимизации во многом зависят от языка, компилятора и среды. Не оценив результатов оптимизации, вы не сможете сказать, помогает она программе или вредит;
- первый вид оптимизации часто далеко не самый лучший. Обнаружив эффективный вид оптимизации, продолжайте пробовать и, возможно, найдёте еще более эффективный;
- оптимизация кода похожа на ядерную энергию - это противоречивая и эмоциональная тема. Кто-то считает, что оптимизация настолько ухужшает надежность и удобство сопровождения программы, что ее вообще выполнять не слудет. Другие думают, что при соблюдении должной предосторожности она приносит пользу.